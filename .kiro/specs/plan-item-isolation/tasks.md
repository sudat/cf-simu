# Implementation Plan

- [x] 1. データ構造の移行とアダプター関数の実装

  - 新しいデータ構造`itemPlans`の定義を追加
  - 既存の`globalPlans`から新構造への移行関数を実装
  - 後方互換性を保つためのアダプター関数を作成
  - _Requirements: 4.1, 4.2, 4.3, 4.4_

- [x] 1.5. グローバルプラン関数の削除とクリーンアップ

  - 不要になったグローバルプラン関数（`addPlan`, `deletePlan`, `renamePlan`, `setActivePlan`, `getActivePlan`）を削除
  - `globalPlans`配列と GlobalPlanState interface を削除
  - 既存コードでのグローバルプラン参照を項目別プラン関数に置き換え
  - 影響を受ける UI コンポーネントを更新
  - _Requirements: 1.1, 2.1, 4.3_

- [x] 2. プラン管理ストアのコア関数を項目別対応に更新

  - `addPlan`関数を項目別独立管理に変更
  - `deletePlan`関数を項目別スコープに変更
  - `renamePlan`関数を項目別対応に更新
  - _Requirements: 1.1, 1.3, 2.2, 2.4_

- [x] 3. 新しいプラン取得関数の実装

  - `getAvailablePlans`関数を実装（項目別プラン + デフォルトプラン）
  - デフォルトプランの自動提供ロジックを実装
  - プラン存在チェック関数を項目別対応に更新
  - _Requirements: 2.1, 3.1, 3.3, 3.4_

- [x] 4. デフォルトプランの特別扱い実装

  - デフォルトプランの削除防止ロジックを強化
  - 新規項目作成時のデフォルトプラン自動追加
  - デフォルトプランの項目間共有ロジック
  - _Requirements: 3.1, 3.2, 3.3, 3.4_

- [x] 5. プラン管理ダイアログの項目別表示対応

  - `PlanManagementDialog`を項目別プラン表示に変更
  - プラン一覧表示ロジックを新しい`getAvailablePlans`に対応
  - プラン選択・削除・編集の項目スコープ対応
  - _Requirements: 2.1, 2.3, 2.4_

- [x] 6. プラン追加ダイアログの項目別対応

  - `AddPlanDialog`のプラン追加を項目別に限定
  - プラン名重複チェックを項目内スコープに変更
  - エラーメッセージを項目別対応に更新
  - _Requirements: 1.1, 2.2_

  **完了理由**: AddPlanDialog コンポーネントで`currentItemName`を使用した項目別プラン追加機能を実装。重複チェックを項目内スコープに変更し、エラーメッセージも項目別に対応済み。プラン作成が選択中の項目に限定されることを確認。

- [x] 7. データ移行とバリデーション機能の実装

  - 既存データの自動移行ロジック
  - データ整合性チェック機能
  - 移行エラーハンドリング
  - _Requirements: 4.1, 4.2, 4.3, 4.4_

- [x] 8. エラーハンドリングとバリデーションの強化

  - 項目別プラン操作のバリデーション強化
  - 適切なエラーメッセージの実装
  - 必須パラメータ（itemName）の検証
  - _Requirements: 1.4, 2.1, 2.2, 2.3, 2.4_

- [x] 9. 統合テストとデバッグ

  - 項目別プラン管理の動作確認
  - 複数項目での同名プラン作成テスト
  - プラン削除の独立性テスト
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [x] 10. 最終検証とクリーンアップ

  - 全機能の動作確認
  - 不要なデバッグログの削除
  - パフォーマンステスト
  - _Requirements: 4.3_
