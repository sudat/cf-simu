# Implementation Plan

## Overview

収支項目管理機能に削除・リネーム機能を追加するための実装タスクです。既存のプラン管理ダイアログのパターンを参考に、段階的に機能を実装します。

## Tasks

- [ ] 1. PlanStoreの拡張 - 項目削除・リネーム機能の実装
  - PlanStoreにremoveItemメソッドを追加
  - PlanStoreにrenameItemメソッドを追加
  - データ整合性を保つためのバリデーション機能を実装
  - 削除時に関連するプラン定義と設定データも削除する処理を実装
  - リネーム時に全データ構造で項目名を一括更新する処理を実装
  - _Requirements: 1.3, 1.4, 2.3, 5.1, 5.2, 5.4_

- [ ] 2. 削除確認ダイアログコンポーネントの作成
  - ItemDeleteConfirmDialogコンポーネントを作成
  - 削除対象項目名の表示機能を実装
  - 関連データ削除の警告メッセージを表示
  - 確認・キャンセルボタンの動作を実装
  - _Requirements: 3.1, 3.2, 3.3, 3.4_

- [ ] 3. インライン編集機能の実装
  - 項目名のインライン編集状態管理を実装
  - テキストフィールドの表示・非表示切り替え機能を実装
  - Enter/Escapeキーでの確定・キャンセル機能を実装
  - フォーカス時のテキスト全選択機能を実装
  - 空文字・重複名のバリデーション機能を実装
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 4.1, 4.2, 4.3, 4.4_

- [ ] 4. PlanDialogのUI拡張
  - CategorySectionコンポーネントに削除・リネームボタンを追加
  - ボタンのアイコン（Edit, Trash2）とスタイリングを実装
  - ツールチップ機能を追加
  - 既存のボタン配置との統一感を保つスタイリングを実装
  - モバイル表示対応のレスポンシブデザインを実装
  - _Requirements: 1.1, 2.1, 6.1, 6.2, 6.3, 6.4_

- [ ] 5. 項目削除機能の統合
  - PlanDialogに削除ボタンのクリックハンドラーを実装
  - 削除確認ダイアログの表示制御を実装
  - PlanStore.removeItemメソッドとの連携を実装
  - 削除完了後のUI更新処理を実装
  - エラーハンドリングとエラーメッセージ表示を実装
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 3.1, 3.2, 3.3, 3.4_

- [ ] 6. 項目リネーム機能の統合
  - PlanDialogにリネームボタンのクリックハンドラーを実装
  - インライン編集モードの開始・終了制御を実装
  - PlanStore.renameItemメソッドとの連携を実装
  - リネーム完了後のUI更新処理を実装
  - バリデーションエラーの表示機能を実装
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 4.1, 4.2, 4.3, 4.4_

- [ ] 7. エラーハンドリングとバリデーションの強化
  - システム重要項目（給与、生活費）の削除防止機能を実装
  - 項目名の文字数制限（50文字以内）チェックを実装
  - 重複項目名のチェック機能を実装
  - エラーメッセージの定数化と多言語対応準備を実装
  - lastErrorを使用したエラー表示機能を実装
  - _Requirements: 4.3, 4.4, 5.3_

- [ ] 8. データ整合性チェック機能の拡張
  - 削除・リネーム操作後のデータ整合性検証を実装
  - 孤立したプラン定義の検出・修復機能を実装
  - ローカルストレージの適切な更新確認機能を実装
  - 既存のvalidateDataConsistency機能との連携を実装
  - _Requirements: 5.1, 5.2, 5.3, 5.4_

- [ ] 9. 単体テストの実装
  - PlanStore.removeItemメソッドのテストを作成
  - PlanStore.renameItemメソッドのテストを作成
  - バリデーション機能のテストを作成
  - データ整合性チェック機能のテストを作成
  - エラーハンドリングのテストを作成
  - _Requirements: 全要件のテストカバレッジ確保_

- [ ] 10. 統合テストとE2Eテストの実装
  - 削除操作のフルフローテストを作成
  - リネーム操作のフルフローテストを作成
  - UI操作のテスト（ボタンクリック、ダイアログ表示）を作成
  - エラーケースのテスト（重複名、システム項目削除など）を作成
  - モバイル表示でのタッチ操作テストを作成
  - _Requirements: 全要件の統合テスト_

- [ ] 11. パフォーマンス最適化とクリーンアップ
  - 不要な再レンダリングの防止（React.memo使用）を実装
  - 大量項目での操作パフォーマンス最適化を実装
  - メモリリークの防止（イベントリスナー削除）を実装
  - ローカルストレージ更新の最適化を実装
  - コードの最終クリーンアップとリファクタリングを実行
  - _Requirements: パフォーマンス要件_

- [ ] 12. ドキュメント更新と最終確認
  - 新機能の使用方法ドキュメントを作成
  - 既存機能への影響がないことを確認
  - 後方互換性の確認を実施
  - 全要件の最終確認とテスト実行
  - リリース準備とデプロイメント確認
  - _Requirements: 全要件の最終確認_