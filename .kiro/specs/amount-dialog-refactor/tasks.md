# Implementation Plan

- [x] 1. Phase 1: ユーティリティ関数の抽出

  - 既存の AmountDialog から純粋関数を抽出し、独立したモジュールとして分離
  - 他のコンポーネントへの影響を最小化しながら再利用可能な関数群を作成
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [x] 1.1 formatters.ts の作成

  - formatNumber 関数と getDisplayValue 関数を抽出
  - 数値フォーマット機能をテスト可能な独立モジュールに分離
  - 既存の AmountDialog から該当関数を削除し、新モジュールをインポート
  - _Requirements: 2.1, 2.4_

- [x] 1.2 calculations.ts の作成

  - calculateCompoundGrowth 関数を抽出
  - 複利計算機能をテスト可能な独立モジュールに分離
  - 既存の AmountDialog から該当関数を削除し、新モジュールをインポート
  - _Requirements: 2.2, 2.4_

- [x] 1.3 validators.ts の作成

  - validateUnifiedForm 関数を抽出
  - バリデーション機能をテスト可能な独立モジュールに分離
  - 既存の AmountDialog から該当関数を削除し、新モジュールをインポート
  - _Requirements: 2.3, 2.4_

- [x] 2. Phase 2: 基本 UI 部品の分離

  - 単純な表示・入力コンポーネントを独立したコンポーネントに分離
  - 再利用可能な UI 部品として他のコンポーネントでも使用可能にする
  - _Requirements: 3.1, 3.2, 3.3, 3.4_

- [x] 2.1 ErrorMessage コンポーネントの作成

  - エラーメッセージ表示機能を独立したコンポーネントに分離
  - ValidationErrors を受け取り適切にエラーを表示する UI 部品を作成
  - 既存の AmountDialog のエラー表示部分を新コンポーネントに置き換え
  - _Requirements: 3.3, 3.4_

- [x] 2.2 AmountInput コンポーネントの作成

  - 金額入力機能（フォーカス状態管理、フォーマット処理含む）を独立したコンポーネントに分離
  - 通貨記号表示、3 桁区切り、フォーカス時の生値表示機能を含む
  - 既存の AmountDialog の金額入力部分を新コンポーネントに置き換え
  - _Requirements: 3.1, 3.4_

- [x] 2.3 YearRangeInput コンポーネントの作成

  - 年度範囲入力機能（開始年度・終了年度）を独立したコンポーネントに分離
  - 年度バリデーション機能を含む入力 UI 部品を作成
  - 既存の AmountDialog の年度入力部分を新コンポーネントに置き換え
  - _Requirements: 3.2, 3.4_

- [ ] 3. Phase 3: 複雑 UI 部品の分離

  - 計算ロジックを含む複雑な表示コンポーネントを分離
  - ビジネスロジックと表示ロジックの分離を実現
  - _Requirements: 3.4_

- [ ] 3.1 CalculationExample コンポーネントの作成

  - 計算例表示機能（getUnifiedCalculationExample 等）を独立したコンポーネントに分離
  - 複雑な条件分岐を含む計算例生成と表示機能を含む
  - 既存の AmountDialog の計算例表示部分を新コンポーネントに置き換え
  - _Requirements: 3.4_

- [ ] 4. Phase 4: カスタムフックの作成

  - 状態管理とビジネスロジックをカスタムフックに分離
  - コンポーネントから複雑なロジックを分離し、テスト可能にする
  - _Requirements: 4.1, 4.2, 4.3, 4.4_

- [ ] 4.1 useAmountCalculation フックの作成

  - 計算例生成ロジックを独立したカスタムフックに分離
  - フォームデータを受け取り計算例を生成する機能を提供
  - CalculationExample コンポーネントで使用するためのフック
  - _Requirements: 4.1, 4.4_

- [ ] 4.2 useAmountValidation フックの作成

  - バリデーションロジックを独立したカスタムフックに分離
  - フォームデータを受け取りリアルタイムバリデーションを提供
  - バリデーション結果とフォーム有効性を返すフック
  - _Requirements: 4.2, 4.4_

- [ ] 4.3 useAmountForm フックの作成

  - フォーム状態管理を独立したカスタムフックに分離
  - 統合フォーム、フローフォーム、ストックフォームの状態管理を統合
  - フォームデータの更新、初期化、変換機能を提供
  - _Requirements: 4.3, 4.4_

- [ ] 5. Phase 5: フォームコンポーネントの分割

  - 各フォームタイプを独立したコンポーネントに分離
  - 単一責任原則に従い、各フォームが特定の項目タイプのみを担当
  - _Requirements: 5.1, 5.2, 5.3, 5.4_

- [ ] 5.1 UnifiedForm コンポーネントの作成

  - 統合フォーム機能を独立したコンポーネントに分離
  - AmountSettingFormData を使用する新形式のフォーム
  - 作成済みの UI 部品とカスタムフックを組み合わせて構築
  - _Requirements: 5.1, 5.4_

- [ ] 5.2 FlowForm コンポーネントの作成

  - フロー項目フォーム機能を独立したコンポーネントに分離
  - FlowItemDetail を使用する既存形式のフォーム
  - 作成済みの UI 部品とカスタムフックを組み合わせて構築
  - _Requirements: 5.2, 5.4_

- [ ] 5.3 StockForm コンポーネントの作成

  - ストック項目フォーム機能を独立したコンポーネントに分離
  - StockItemDetail を使用する既存形式のフォーム
  - 作成済みの UI 部品とカスタムフックを組み合わせて構築
  - _Requirements: 5.3, 5.4_

- [ ] 6. Phase 6: メインダイアログの統合

  - メインダイアログを簡素化し、ルーティングと統合処理のみに集中
  - 分割されたコンポーネント群を統合して元の機能を再現
  - _Requirements: 6.1, 6.2, 6.3, 6.4_

- [ ] 6.1 AmountDialog の簡素化

  - メイン AmountDialog コンポーネントを 200 行以下に簡素化
  - フォームタイプの判定とルーティング機能のみを残す
  - 分割されたフォームコンポーネントを適切に呼び出す構造に変更
  - _Requirements: 6.1, 6.2_

- [ ] 6.2 統合テストの実行

  - 分割後のダイアログが元のダイアログと同じ機能を提供することを確認
  - 既存のテストが全て通ることを確認
  - UI/UX の一貫性を確認
  - _Requirements: 6.3, 6.4_

- [ ] 6.3 index.ts ファイルの作成

  - amount-dialog ディレクトリのエクスポートファイルを作成
  - 外部からの使用を簡素化するためのエクスポート設定
  - 後方互換性を確保するためのエクスポート構成
  - _Requirements: 1.3_

- [ ] 7. 最終検証とクリーンアップ

  - 全体的な動作確認と不要コードの削除
  - パフォーマンステストと最適化
  - _Requirements: 1.1, 1.2, 1.3_

- [ ] 7.1 回帰テストの実行

  - 既存機能の完全な動作確認
  - エラーハンドリングの確認
  - 各フォームタイプでの動作確認
  - _Requirements: 1.2_

- [ ] 7.2 コードクリーンアップ
  - 不要なコメントやデバッグコードの削除
  - インポート文の整理
  - TypeScript 型定義の最適化
  - _Requirements: 1.1, 1.3_
